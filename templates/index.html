<!DOCTYPE html>
<html>
<head>
    <title>NDVI / Rainfall</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        #m {height:100vh;}
        #datePicker {
            position:absolute;
            top:10px;
            left:10px;
            z-index:1100;
            background:white;
            padding:5px 8px;
            border-radius:4px;
            box-shadow:0 0 5px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>
<div id="m"></div>

<!-- Simple date input -->
<input type="date" id="datePicker" />

<!-- Legend Container -->
<div id="legend"
     style="
        position:absolute;
        bottom:20px;
        right:10px;
        background:white;
        padding:10px;
        border-radius:5px;
        box-shadow:0 0 10px rgba(0,0,0,0.2);
        z-index:1000;
        font-size:12px;
        line-height:1.4;
     ">
  <strong>Rainfall (mm)</strong>

  <div style="margin-top:6px;">
    <div style="display:flex; align-items:center;">
      <span style="width:18px;height:12px;background:#deebf7;display:inline-block;margin-right:6px;"></span>
      0 – 25 (Very Low)
    </div>
    <div style="display:flex; align-items:center;">
      <span style="width:18px;height:12px;background:#9ecae1;display:inline-block;margin-right:6px;"></span>
      25 – 75 (Low)
    </div>
    <div style="display:flex; align-items:center;">
      <span style="width:18px;height:12px;background:#3182bd;display:inline-block;margin-right:6px;"></span>
      75 – 150 (Moderate)
    </div>
    <div style="display:flex; align-items:center;">
      <span style="width:18px;height:12px;background:#08306b;display:inline-block;margin-right:6px;"></span>
      150 – 250 (High)
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('m').setView([-18.7, 29.5], 7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
}).addTo(map);

// Hardcoded Zimbabwe bounds
const zimBounds = L.latLngBounds([[-35.004, 10.995], [-7.995, 41.004]]);

let rainfallLayer = L.imageOverlay(
    'http://localhost:5000/api/classified_rainfall_tif/2001-12-11',
    zimBounds,
    {opacity:0.7}
).addTo(map);

// Load admin boundaries
fetch('/static/data/zim_admin1.geojson')
    .then(resp => resp.json())
    .then(data => {
        L.geoJSON(data, {
            style: {color:'#FF0000', weight:1, fillOpacity:0},
            onEachFeature: (feature, layer) => {
                if(feature.properties && feature.properties.ADM1_EN){
                    layer.bindTooltip(feature.properties.ADM1_EN);
                }
            }
        }).addTo(map);
    });

// --- DATE PICKER LOGIC ---
const picker = document.getElementById('datePicker');

picker.addEventListener('change', () => {
    const selectedDate = picker.value; // format YYYY-MM-DD
    if(!selectedDate) return;

    const url = `http://localhost:5000/api/classified_rainfall_tif/${selectedDate}`;

    // Remove previous layer
    if(rainfallLayer) map.removeLayer(rainfallLayer);

    // Add new rainfall layer
    rainfallLayer = L.imageOverlay(url, zimBounds, {opacity:0.7}).addTo(map);
});
</script>
</body>
</html>
